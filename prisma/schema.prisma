// schema.prisma

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

generator client {
  provider = "prisma-client-js"
}

//
// ENUMS
//

// 大類別（前台主選單用）
enum Category {
  GIFT        // 禮品
  GIFT_BOX    // 包裝盒
  GIFT_SET    // 禮品套組
}

// 產品狀態（後台管理用）
enum ProductStatus {
  DRAFT
  ACTIVE
  ARCHIVED
}

//
// MODELS
//

model Product {
  id    String @id @default(cuid())
  slug  String @unique
  name  String

  // 大方向類別（GIFT / GIFT_BOX / GIFT_SET）
  category Category

  // 前台短說明 / 內文
  shortDesc   String?
  description String?

  // 圖片
  coverImage String?   // 首圖
  images     String[]  // 其他細節圖 URL

  // 基本商業資訊
  sku       String?  @unique
  minQty    Int?
  priceHint String?
  currency  String?

  // 產品狀態
  status ProductStatus @default(ACTIVE)

  // 更細緻的規格（前台 detail page 用）
  leadTime      String? // 交期，例如 "約 25–30 天（不含運輸）"
  materials     String? // 主要材質描述
  dimensions    String? // 完成尺寸／可放 L×W×H 或 mm
  packagingInfo String? // 單品包裝 & 外箱裝量
  originCountry String? // 產地：CN / TW / etc.
  unit          String? // 計價單位：set / pc / pair…
  notesForBuyer String? // 給採購看的備註（注意事項、建議量）

  // 關聯：tags（用來做所有分類篩選）
  tags ProductTag[]

  // 關聯：這個產品是否本身是一個 GiftSet master
  giftSet GiftSet?

  // 關聯：如果這個產品被其他 GiftSet 當成子項目
  giftSetItems GiftSetItem[]

  // SEO
  seoTitle       String?
  seoDescription String?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Tag {
  id    String @id @default(cuid())
  slug  String @unique
  name  String
  color String?

  // 前台小標題（例如「中秋月餅禮盒」、「ESG 禮品方案」）
  subtitle String?

  products  ProductTag[]
  blogPosts BlogTag[]

  // /products 分類頁用：FrontCategory 底下的 group 對應到哪個 Tag
  frontCategoryGroups FrontCategoryTagGroup[]
}

model ProductTag {
  productId String
  tagId     String

  product Product @relation(fields: [productId], references: [id])
  tag     Tag     @relation(fields: [tagId], references: [id])

  @@id([productId, tagId])
}

model GiftSet {
  id        String @id @default(cuid())
  productId String @unique

  // 這個 GiftSet 本身對應到一個 Product（category = GIFT_SET）
  product Product @relation(fields: [productId], references: [id])

  // 套組裡的子項目
  items GiftSetItem[]
}

model GiftSetItem {
  id        String @id @default(cuid())
  giftSetId String
  productId String
  quantity  Int    @default(1)

  // 關聯到 GiftSet
  giftSet GiftSet @relation(fields: [giftSetId], references: [id])

  // 關聯到 Product（這個套組裡的某個商品）
  product Product @relation(fields: [productId], references: [id])

  @@index([giftSetId])
  @@index([productId])
}

model BlogPost {
  id          String   @id @default(cuid())
  slug        String   @unique
  title       String
  excerpt     String?
  content     String   // 之後可以存 Markdown
  coverImage  String?
  publishedAt DateTime?
  isPublished Boolean  @default(false)

  tags      BlogTag[]
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model BlogTag {
  blogPostId String
  tagId      String

  blogPost BlogPost @relation(fields: [blogPostId], references: [id])
  tag      Tag      @relation(fields: [tagId], references: [id])

  @@id([blogPostId, tagId])
}

model Page {
  id    String @id @default(cuid())
  slug  String @unique
  title String

  // 之後可以換成 rich text / JSON，先用 String 保存
  content        String
  heroImage      String?
  seoTitle       String?
  seoDescription String?

  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt
}

model AdminUser {
  id       String @id @default(cuid())
  email    String @unique
  name     String?
  password String
  role     String @default("admin")
}

model FrontCategory {
  id          String   @id @default(cuid())
  slug        String   @unique   // URL 用：gifts, gift-boxes, gift-sets, services...
  name        String             // 導覽 / 卡片標題用：例如 "Gifts"

  // 單一分項內頁 hero 區塊文案
  heroTitle     String?          // 分類頁大標題
  heroSubtitle  String?          // 分類頁副標
  heroImage     String?          // 分類頁 hero 圖片 URL（可用圖床 / 上傳）

  // /products 總覽頁上的卡片內容
  cardTitle       String?        // 總覽卡片大標
  cardDescription String?        // 卡片描述
  cardImage       String?        // 卡片圖片 URL（可用圖床 / 上傳）

  // 可選：對應 Product.Category 作為基礎篩選
  baseCategory Category?

  order       Int      @default(0)
  isActive    Boolean  @default(true)

  tagGroups   FrontCategoryTagGroup[]

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

model FrontCategoryTagGroup {
  id              String @id @default(cuid())
  frontCategoryId String
  frontCategory   FrontCategory @relation(fields: [frontCategoryId], references: [id])

  label       String        // 分組的小標，例如 "Mid-Autumn programs"
  description String?       // 可選，放在分組標題下面

  // 新欄位：必填 FK
  tagId  String
  tag    Tag @relation(fields: [tagId], references: [id])

  order       Int    @default(0)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}


model ImageAsset {
  id        String   @id @default(cuid())
  url       String
  label     String?
  createdAt DateTime @default(now())
}

// schema.prisma

enum HomeSectionType {
  HERO
  WHY
  PRODUCTS
  FACTORY
  BLOG
  CTA
  RICH_TEXT   // 未來要加自訂文字區塊可以用這個
}

model HomeSection {
  id        Int             @id @default(autoincrement())
  type      HomeSectionType
  order     Int             @default(100) // 數字越小越前面
  enabled   Boolean         @default(true)

  /// JSON 內容，依 type 不同有不同結構：
  /// HERO: { titleLine1_en, titleLine1_zh, ... }
  /// WHY / PRODUCTS / FACTORY: { title_en, title_zh, subtitle_en, subtitle_zh, cards: [...] }
  /// BLOG: { title_en, ... , posts: [...] }
  /// CTA: { title_en, title_zh, body_en, body_zh, ... }
  payload   Json

  createdAt DateTime        @default(now())
  updatedAt DateTime        @updatedAt
}

